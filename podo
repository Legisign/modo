#!/usr/bin/zsh
#
# podo -- create `.po` from `.mo` for editing
#
# Usage: podo mofile ... target-dir
#
# 2021-07-19    Using `shift` to discard the first element in `mofiles`.

emulate -L zsh

local dest mofile
local -a mofiles

# msgfmt required
if [[ -z $(whence msgfmt) ]]; then
    print -- ${0:t}: Asenna ensin gettext 1>&2
    exit 1
fi

if (( $# < 2 )); then
    print -- ${0:t}: käyttö: ${0:t} motsto... kohdekansio 1>&2
    exit 2
fi

# Parse parameters
shift mofiles
dest=$@[$#]
if [[ ! -d $dest ]]; then
    print -- ${0:t}: $dest ei ole \(kohde\)kansio 1>&2
    exit 2
fi

# Compile files
for mofile in $mofiles; do
    print -- ${0:t}: "$mofile" -\> "$dest"
    if [[ ! -r $mofile || $mofile != *.mo ]]; then
        print -- ${0:t}: "$mofile" ei ole .mo-tiedosto tai ei voi lukea 1>&2
        exit 2
    fi
    msgunfmt -o $dest/${mofile:t:r}.po $mofile
done
