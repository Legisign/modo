#!/usr/bin/zsh
#
# install_modos -- install modo, qmdo and l10nrestore
#
# 2016-09-13    Ready. (TN)
# 2016-09-17    podo added. do_install function. (TN)
# 2016-09-18    No need to install unless source is newer. (TN)
# 2016-10-01    Bug fix: of course one needs to check if the files exist
#               before checking their age! (TN)
# 2017-01-30    Added $localgroup handling. (TN)
# 2017-02-17    Bug fix. (TN)
# 2017-03-07    Getting rid of csh-like syntax. (TN)
# 2017-03-07    Simplifications. (TN)

emulate -L zsh

local binroot instopts localgroup

if [[ $EUID -ne 0 ]]; then
    print -- ${0:t}: YllÃ¤pito-oikeudet vaaditaan\! 1>&2
    exit 1
fi

# Settings
grep -q staff /etc/group && localgroup=staff
grep -q wheel /etc/group && localgroup=wheel
: ${localgroup:=root}
binroot=/usr/local
instopts=(-g $localgroup -m 755)

do_install() {
    local dest src

    dest=$@[-1]
    for src in $[1, -2]; do
        if [[ ! -f $dest/${src:r} || $src -nt $dest/${src:r} ]]; then
            print -- $src -\> $dest/${src:r}
            install $instopts $src $dest/${src:r}
        fi
    done
}

# Programs requiring superuser privileges
do_install modo qmdo l10nrestore.py $binroot/sbin

# Programs that don't require superuser privileges
do_install podo $binroot/bin
